
/*----------------------------------[DEPENDENCIES]---------------------------------*/
#include "sys.h"
#include "delay.h"
#include "usart.h" 
#include "led.h"
#include "key.h" 
#include "ltdc.h"
#include "lcd.h"
#include "sdram.h"
#include "usmart.h"
#include "pcf8574.h"
#include "mpu.h"
#include "malloc.h"
#include "w25qxx.h"
#include "sdmmc_sdcard.h"
#include "timer.h"
#include "arm_math.h"
#include "nand.h"    
#include "ftl.h"  
#include "ff.h"
#include "exfuns.h"
/*----------------------------------<DEPENDENCIES>---------------------------------*/

/*----------------------------------[STATEMENTS]-----------------------------------*/

/**
 * ! STATEMENTS
 * @param disp_est_filter_length The length of the filter
 * @param disp_est_filter The filter coefficients
 * @param disp_est_block_size The block size of the filter 
 * @param S_disp_est The filter instance for displacement estimation
 * @param FIR_state_f32_disp_est The filter state for displacement estimation
 */

#define disp_est_filter_length 523
float disp_est_filter[disp_est_filter_length] = {0.1991505545171962, 0.20370288472602008, 0.208122392751063, 0.21240236929672124, 0.21653114035567383, 0.22050190414028345, 0.22430283764129783, 0.22792708817235535, 0.23136272488372558, 0.2346028885475024, 0.2376355843079833, 0.2404539934466603, 0.24304610352820383, 0.24540518600041095, 0.247519259767243, 0.24938173859966417, 0.2509807240345649, 0.2523098266982049, 0.25335728429189963, 0.25411696106081766, 0.2545772864837904, 0.254732437256813, 0.25457109215497215, 0.254087801042462, 0.2532715512191749, 0.2521173281176678, 0.2506144882851344, 0.2487585165829132, 0.24653920078603067, 0.2439525902628775, 0.24098896699900527, 0.23764501090387333, 0.23391156188272152, 0.22978599709425487, 0.2252597785038541, 0.22033104760110214, 0.21499195266895652, 0.20924146666362078, 0.20307248822715973, 0.19648488863485147, 0.18947238036265443, 0.1820357992193472, 0.17416973405480557, 0.1658760504164884, 0.1571502747491397, 0.14799536614810402, 0.1384078481553043, 0.12839183542606544, 0.11794490596949068, 0.10707238980159013, 0.09577297420985048, 0.08405326173422084, 0.07191310075511027, 0.05936042042588851, 0.04639627859007486, 0.033029981585238864, 0.019263841188016863, 0.005108587520510558, -0.009432173599830892, -0.024346246093139304, -0.03962869482225263, -0.055265820462907476, -0.07125132857687261, -0.0875699846556489, -0.10421411074494959, -0.12116691101754867, -0.13841930602105432, -0.1559529187348951, -0.1737572569213458, -0.191812349199705, -0.21010628640916396, -0.22861749678870283, -0.24733265771096255, -0.26622859858784226, -0.2852905948084752, -0.3044938864964254, -0.3238223669837066, -0.34324970502425023, -0.36275844066126234, -0.38232069795153023, -0.40191770163709034, -0.42152006685405224, -0.44110775060348695, -0.46064990430477243, -0.48012527467684957, -0.4995016043474857, -0.5187564974068509, -0.5378563525981763, -0.5567777094934074, -0.5754856980650123, -0.5939558821608942, -0.612152208488832, -0.6300493648377422, -0.6476102106924735, -0.6648086684639873, -0.6816066170897878, -0.6979773353999864, -0.7138818391440831, -0.7292928965368481, -0.7441707881817022, -0.758487915813864, -0.7722039635601513, -0.7852911219311892, -0.7977086277626572, -0.8094286266082282, -0.8204100675432756, -0.8306252282807596, -0.8400329397799364, -0.8486057996541726, -0.8563027002085593, -0.8630967570377255, -0.8689471127111656, -0.8738276088772049, -0.8776978363164796, -0.8805325803825599, -0.8822920865448679, -0.8829523106150734, -0.882474367192605, -0.8808356178575532, -0.8779982681057725, -0.8739413285432921, -0.8686283239439228, -0.8620401644676344, -0.8541419283806704, -0.844916682452634, -0.8343312976353302, -0.8223712600832703, -0.8090054766795264, -0.7942221205861211, -0.7779923809184499, -0.7603073893812466, -0.7411408656113183, -0.7204871743087762, -0.6983228147729521, -0.6746456610165515, -0.6494352407916755, -0.6226932144977904, -0.5944023855115407, -0.5645684772916385, -0.5331778130628411, -0.5002404544084329, -0.46574648428773097, -0.42971057461921675, -0.3921268022013329, -0.35301471735943163, -0.3123726175568553, -0.2702251941435667, -0.22657518324978632, -0.18145267307479923, -0.13486504600514976, -0.08684803476517527, -0.037413863546878534, 0.013395852238451182, 0.06556386474644947, 0.11904244859590934, 0.17380916583632228, 0.2298099660684993, 0.28701707188970293, 0.3453699064062774, 0.4048352222577442, 0.46534572945750696, 0.5268626007681696, 0.5893116626541034, 0.652648420421518, 0.7167916638816267, 0.7816911674003325, 0.8472585495246181, 0.913437816045339, 0.9801332991850559, 1.0472832261211396, 1.1147845482010048, 1.1825697332835459, 1.2505282786418577, 1.3185869431694148, 1.3866277189241476, 1.454571738955972, 1.5222934615761297, 1.5897085115788792, 1.6566838079792305, 1.7231296210557838, 1.7889053481292123, 1.8539160965343682, 1.9180137825894092, 1.9810985817709796, 2.043014992852839, 2.1036585317484047, 2.162866365290271, 2.220529665060243, 2.276478372738746, 2.330599675526379, 2.38271641658155, 2.4327122052615566, 2.4804029308888653, 2.5256690800998194, 2.5683197488314216, 2.6082328068854133, 2.6452107301513825, 2.679129330679742, 2.709784646980022, 2.737051048409334, 2.7607183237357877, 2.7806600738972835, 2.79666002522518, 2.8085917475868354, 2.816233085409327, 2.819458382588291, 2.8180397675988, 2.8118532369674165, 2.8006653451063626, 2.7843547004543616, 2.7626823896312103, 2.735530681997089, 2.7026552528784156, 2.663943182823603, 2.619144725144306, 2.5681530379256454, 2.5107128528331666, 2.4467248071467593, 2.3759278951240055, 2.298231795365587, 2.213369398289139, 2.1212611796288883, 2.0216333644888906, 1.9144192195296053, 1.7993374902363501, 1.676336525669705, 1.5451264481459184, 1.4056733597306035, 1.2576771840427257, 1.1011249385452808, 0.9357041999927015, 0.7614267137024009, 0.5779647922551525, 0.38535959774224476, 0.18326421142999905, -0.02824489184022595, -0.24953929010961026, -0.4804995983361927, -0.7215295616447336, -0.9724568256081149, -1.233727852174847, -1.505103588874022, -1.7870883580460508, -2.079357017082102, -2.3824940994816792, -2.696059869510587, -3.0207532637215597, -3.3559760346312753, -3.7025963055314395, -4.059785619525566, -4.428674543657784, -4.808078430366853, -5.199562498189867, -5.601341688992452, -6.015772325044273, -6.43992431078375, -6.877821139791902, -7.323873636142883, -7.786657175418763, -8.251540651972132, -8.750124119241153, -9.131145735446783, -8.750124119241153, -8.251540651972132, -7.786657175418763, -7.323873636142883, -6.877821139791902, -6.43992431078375, -6.015772325044273, -5.601341688992452, -5.199562498189867, -4.808078430366853, -4.428674543657784, -4.059785619525566, -3.7025963055314395, -3.3559760346312753, -3.0207532637215597, -2.696059869510587, -2.3824940994816792, -2.079357017082102, -1.7870883580460508, -1.505103588874022, -1.233727852174847, -0.9724568256081149, -0.7215295616447336, -0.4804995983361927, -0.24953929010961026, -0.02824489184022595, 0.18326421142999905, 0.38535959774224476, 0.5779647922551525, 0.7614267137024009, 0.9357041999927015, 1.1011249385452808, 1.2576771840427257, 1.4056733597306035, 1.5451264481459184, 1.676336525669705, 1.7993374902363501, 1.9144192195296053, 2.0216333644888906, 2.1212611796288883, 2.213369398289139, 2.298231795365587, 2.3759278951240055, 2.4467248071467593, 2.5107128528331666, 2.5681530379256454, 2.619144725144306, 2.663943182823603, 2.7026552528784156, 2.735530681997089, 2.7626823896312103, 2.7843547004543616, 2.8006653451063626, 2.8118532369674165, 2.8180397675988, 2.819458382588291, 2.816233085409327, 2.8085917475868354, 2.79666002522518, 2.7806600738972835, 2.7607183237357877, 2.737051048409334, 2.709784646980022, 2.679129330679742, 2.6452107301513825, 2.6082328068854133, 2.5683197488314216, 2.5256690800998194, 2.4804029308888653, 2.4327122052615566, 2.38271641658155, 2.330599675526379, 2.276478372738746, 2.220529665060243, 2.162866365290271, 2.1036585317484047, 2.043014992852839, 1.9810985817709796, 1.9180137825894092, 1.8539160965343682, 1.7889053481292123, 1.7231296210557838, 1.6566838079792305, 1.5897085115788792, 1.5222934615761297, 1.454571738955972, 1.3866277189241476, 1.3185869431694148, 1.2505282786418577, 1.1825697332835459, 1.1147845482010048, 1.0472832261211396, 0.9801332991850559, 0.913437816045339, 0.8472585495246181, 0.7816911674003325, 0.7167916638816267, 0.652648420421518, 0.5893116626541034, 0.5268626007681696, 0.46534572945750696, 0.4048352222577442, 0.3453699064062774, 0.28701707188970293, 0.2298099660684993, 0.17380916583632228, 0.11904244859590934, 0.06556386474644947, 0.013395852238451182, -0.037413863546878534, -0.08684803476517527, -0.13486504600514976, -0.18145267307479923, -0.22657518324978632, -0.2702251941435667, -0.3123726175568553, -0.35301471735943163, -0.3921268022013329, -0.42971057461921675, -0.46574648428773097, -0.5002404544084329, -0.5331778130628411, -0.5645684772916385, -0.5944023855115407, -0.6226932144977904, -0.6494352407916755, -0.6746456610165515, -0.6983228147729521, -0.7204871743087762, -0.7411408656113183, -0.7603073893812466, -0.7779923809184499, -0.7942221205861211, -0.8090054766795264, -0.8223712600832703, -0.8343312976353302, -0.844916682452634, -0.8541419283806704, -0.8620401644676344, -0.8686283239439228, -0.8739413285432921, -0.8779982681057725, -0.8808356178575532, -0.882474367192605, -0.8829523106150734, -0.8822920865448679, -0.8805325803825599, -0.8776978363164796, -0.8738276088772049, -0.8689471127111656, -0.8630967570377255, -0.8563027002085593, -0.8486057996541726, -0.8400329397799364, -0.8306252282807596, -0.8204100675432756, -0.8094286266082282, -0.7977086277626572, -0.7852911219311892, -0.7722039635601513, -0.758487915813864, -0.7441707881817022, -0.7292928965368481, -0.7138818391440831, -0.6979773353999864, -0.6816066170897878, -0.6648086684639873, -0.6476102106924735, -0.6300493648377422, -0.612152208488832, -0.5939558821608942, -0.5754856980650123, -0.5567777094934074, -0.5378563525981763, -0.5187564974068509, -0.4995016043474857, -0.48012527467684957, -0.46064990430477243, -0.44110775060348695, -0.42152006685405224, -0.40191770163709034, -0.38232069795153023, -0.36275844066126234, -0.34324970502425023, -0.3238223669837066, -0.3044938864964254, -0.2852905948084752, -0.26622859858784226, -0.24733265771096255, -0.22861749678870283, -0.21010628640916396, -0.191812349199705, -0.1737572569213458, -0.1559529187348951, -0.13841930602105432, -0.12116691101754867, -0.10421411074494959, -0.0875699846556489, -0.07125132857687261, -0.055265820462907476, -0.03962869482225263, -0.024346246093139304, -0.009432173599830892, 0.005108587520510558, 0.019263841188016863, 0.033029981585238864, 0.04639627859007486, 0.05936042042588851, 0.07191310075511027, 0.08405326173422084, 0.09577297420985048, 0.10707238980159013, 0.11794490596949068, 0.12839183542606544, 0.1384078481553043, 0.14799536614810402, 0.1571502747491397, 0.1658760504164884, 0.17416973405480557, 0.1820357992193472, 0.18947238036265443, 0.19648488863485147, 0.20307248822715973, 0.20924146666362078, 0.21499195266895652, 0.22033104760110214, 0.2252597785038541, 0.22978599709425487, 0.23391156188272152, 0.23764501090387333, 0.24098896699900527, 0.2439525902628775, 0.24653920078603067, 0.2487585165829132, 0.2506144882851344, 0.2521173281176678, 0.2532715512191749, 0.254087801042462, 0.25457109215497215, 0.254732437256813, 0.2545772864837904, 0.25411696106081766, 0.25335728429189963, 0.2523098266982049, 0.2509807240345649, 0.24938173859966417, 0.247519259767243, 0.24540518600041095, 0.24304610352820383, 0.2404539934466603, 0.2376355843079833, 0.2346028885475024, 0.23136272488372558, 0.22792708817235535, 0.22430283764129783, 0.22050190414028345, 0.21653114035567383, 0.21240236929672124, 0.208122392751063, 0.20370288472602008, 0.1991505545171962};
int disp_est_block_size = 100;
arm_fir_instance_f32 S_disp_est;			// filter instance for displacement estimation
float32_t *FIR_state_f32_disp_est = {((void *)0)};          // filter state for displacement estimation


/*----------------------------------<STATEMENTS>-----------------------------------*/


/*----------------------------------[FUNCTIONS]------------------------------------*/
int disp_est(void)
{
    printf("disp_est\n");
    delay_ms(1000);

    return 0;
}






















/*----------------------------------<FUNCTIONS>------------------------------------*/